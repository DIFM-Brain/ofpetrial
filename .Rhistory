as.data.frame(.)
farm_name <- df$farm_name
field_name <- df$field_name
year <- df$year
# read in the two geojsons as sf
boundary <- geojson_sf(df$field_geojson) %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
dplyr::select(geometry) %>%
# make_sf_utm(.) %>%
st_union(.) %>%
st_as_sf()
boundary
json_file <- "/Users/brittaniedge/Downloads/parameters_assign_rates_error.json"
#### json filepath ####
# json_file <- "/Users/brittaniedge/Downloads/trial_inputs_renzo.json"
# json_file <- "/Users/brittaniedge/Downloads/trial_inputs_2_inputs.json"
json_file <- "/Users/brittaniedge/Downloads/parameters_assign_rates_error.json"
#### open json ####
# open everything in the json #
df <- jsonlite::fromJSON(json_file) %>%
as.data.frame(.)
farm_name <- df$farm_name
field_name <- df$field_name
year <- df$year
# read in the two geojsons as sf
boundary <- geojson_sf(df$field_geojson) %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
dplyr::select(geometry) %>%
# make_sf_utm(.) %>%
st_union(.) %>%
st_as_sf()
boundary
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_boundary.shp" %>%
st_read()
td <- "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW.shp" %>%
st_read()
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read() %>%
st_transform_utm()
td <- "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW.shp" %>%
st_read() %>%
st_transform_utm()
diff <- st_difference(boundary, st_make_valid(st_union(st_combine(td))))
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read() %>%
st_transform_utm()
td <- "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW.shp" %>%
st_read() %>%
st_transform_utm()
td
boundary
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read() %>%
st_transform_utm()
boundary
td <- "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW.shp" %>%
st_read() %>%
st_transform_utm()
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read() %>%
st_transform(st_crs(td))
diff <- st_difference(boundary, st_make_valid(st_union(st_combine(td)))) %>%
dplyr::select(Field)
diff <- st_difference(boundary, st_make_valid(st_union(st_combine(td))))
diff
diff <- st_difference(boundary, st_make_valid(st_union(st_combine(td))))
td
td_new <- diff %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
mutate(tgt_rate = 0) %>%
mutate(type = "headland") %>%
dplyr::select(tgt_rate, type) %>%
# plyr::rbind.fill(., td_new) %>%
st_as_sf()
td_new
td <- "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW.shp" %>%
st_read() %>%
st_transform_utm()
td
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read() %>%
st_transform(st_crs(td))
diff <- st_difference(boundary, st_make_valid(st_union(st_combine(td))))
td_new <- diff %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
mutate(tgt_rate = 0) %>%
mutate(type = "headland") %>%
dplyr::select(tgt_rate, type) %>%
# plyr::rbind.fill(., td_new) %>%
st_as_sf()
test <- rbind(td, td_new) %>%
st_transform(4326)
td_new
td
td %>%
filter(type == "headland")
td_new <- diff %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
mutate(tgt_rate = 0,
type = "headland",
strip_id = NA,
plot_id = NA) %>%
dplyr::select(tgt_rate, type) %>%
# plyr::rbind.fill(., td_new) %>%
st_as_sf()
test <- rbind(td, td_new) %>%
st_transform(4326)
td_new <- diff %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
mutate(tgt_rate = 0,
type = "headland",
strip_id = NA,
plot_id = NA) %>%
dplyr::select(tgt_rate, type) %>%
# plyr::rbind.fill(., td_new) %>%
st_as_sf()
td_new
td
td_new <- diff %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
mutate(rate = 0,
type = "headland",
strip_id = NA,
plot_id = NA) %>%
dplyr::select(rate, strip_id, plot_id, type) %>%
# plyr::rbind.fill(., td_new) %>%
st_as_sf()
td_new
test <- rbind(td, td_new) %>%
st_transform(4326)
test
st_write(test, "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW-edited.shp")
# bring in boundary and ab-line
# Fornof NE
devtools::load_all()
abline <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_AB_guidance.shp" %>%
st_read() %>%
.[,-c(1:ncol(.))]
rotate_mat_p90 <- matrix(
c(
cos(pi / 2),
sin(pi / 2),
-sin(pi / 2),
cos(pi / 2)
),
nrow = 2
)
ab_xy <- sf::st_geometry(abline)[[1]][2, ] - sf::st_geometry(abline)[[1]][1, ]
ab_length <- sqrt(sum(ab_xy^2))
ab_xy_nml <- ab_xy / ab_length
ab_xy_nml_p90 <- ab_xy_nml %*% rotate_mat_p90
abline <- st_shift(abline, ab_xy_nml_p90*conv_unit(-30, "ft", "m")) # the abline isn't exactly on the border
st_write(abline,
"/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_AB_guidance_shifted.shp",
append = FALSE)
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read()
n_plot_info <-
prep_plot(
input_name = "AMS",
unit_system = "imperial",
machine_width = 60,
section_num = 1,
harvester_width = 30,
headland_length = 60,
side_length = 15,
plot_width = 60,
min_plot_length = 60,
max_plot_length = 100
)
exp_data <-
make_exp_plots(
input_plot_info = n_plot_info,
boundary_data = boundary,
abline_data = abline,
abline_type = "lock"
)
n_rate_info <-
prep_rate(
plot_info = n_plot_info,
gc_rate = 0,
unit = "lb",
min_rate = 0,
max_rate = 80,
num_rates = 2,
design_type = "rstr"
)
td <-
assign_rates(
exp_data = exp_data,
rate_info = n_rate_info
)
viz(td, type = "rates")
write_trial_files(td,
folder_path = "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output",
ext = "shp",
zip = TRUE)
# Fornof NE starts from the SE edge of the field and the plots should start 15' into the field
# Spreader AB line at 45' in.
# Fornof SW is the same starting from the SW edge.
# The spreader width is 60' wide and the combine is 30'.
# There are 2 rates of AMS, 0 lb/ac and 80 lb/ac.
# We would like the strip plots randomized as an RCBD, so over the sets of strips.
# bring in boundary and ab-line
# Fornof NE
devtools::load_all()
abline <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_AB_guidance.shp" %>%
st_read() %>%
.[,-c(1:ncol(.))]
rotate_mat_p90 <- matrix(
c(
cos(pi / 2),
sin(pi / 2),
-sin(pi / 2),
cos(pi / 2)
),
nrow = 2
)
ab_xy <- sf::st_geometry(abline)[[1]][2, ] - sf::st_geometry(abline)[[1]][1, ]
ab_length <- sqrt(sum(ab_xy^2))
ab_xy_nml <- ab_xy / ab_length
ab_xy_nml_p90 <- ab_xy_nml %*% rotate_mat_p90
abline <- st_shift(abline, ab_xy_nml_p90*conv_unit(-(45-2), "ft", "m")) # the abline isn't exactly on the border
st_write(abline,
"/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_AB_guidance_shifted.shp",
append = FALSE)
# shift ab-line 45 feet north as per ELizabeth's email
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read()
n_plot_info <-
prep_plot(
input_name = "AMS",
unit_system = "imperial",
machine_width = 60,
section_num = 1,
harvester_width = 30,
headland_length = 60,
side_length = 15,
plot_width = 60,
min_plot_length = 60,
max_plot_length = 100
)
exp_data <-
make_exp_plots(
input_plot_info = n_plot_info,
boundary_data = boundary,
abline_data = abline,
abline_type = "lock"
)
n_rate_info <-
prep_rate(
plot_info = n_plot_info,
gc_rate = 0,
unit = "lb",
min_rate = 0,
max_rate = 80,
num_rates = 2,
design_type = "rstr"
)
td <-
assign_rates(
exp_data = exp_data,
rate_info = n_rate_info
)
viz(td, type = "rates")
write_trial_files(td,
folder_path = "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output",
ext = "shp",
zip = TRUE)
td <- "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW.shp" %>%
st_read() %>%
st_transform_utm()
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read() %>%
st_transform(st_crs(td))
diff <- st_difference(boundary, st_make_valid(st_union(st_combine(td))))
td_new <- diff %>%
st_as_sf() %>%
st_cast(., "POLYGON") %>%
mutate(rate = 0,
type = "headland",
strip_id = NA,
plot_id = NA) %>%
dplyr::select(rate, strip_id, plot_id, type) %>%
# plyr::rbind.fill(., td_new) %>%
st_as_sf()
test <- rbind(td, td_new) %>%
st_transform(4326)
st_write(test, "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output/trial-design-AMS-SW-edited.shp")
# Fornof NE starts from the SE edge of the field and the plots should start 15' into the field
# Spreader AB line at 45' in.
# Fornof SW is the same starting from the SW edge.
# The spreader width is 60' wide and the combine is 30'.
# There are 2 rates of AMS, 0 lb/ac and 80 lb/ac.
# We would like the strip plots randomized as an RCBD, so over the sets of strips.
# bring in boundary and ab-line
# Fornof NE
devtools::load_all()
abline <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_AB_guidance.shp" %>%
st_read() %>%
.[,-c(1:ncol(.))]
rotate_mat_p90 <- matrix(
c(
cos(pi / 2),
sin(pi / 2),
-sin(pi / 2),
cos(pi / 2)
),
nrow = 2
)
ab_xy <- sf::st_geometry(abline)[[1]][2, ] - sf::st_geometry(abline)[[1]][1, ]
ab_length <- sqrt(sum(ab_xy^2))
ab_xy_nml <- ab_xy / ab_length
ab_xy_nml_p90 <- ab_xy_nml %*% rotate_mat_p90
abline <- st_shift(abline, ab_xy_nml_p90*(conv_unit(-30, "ft", "m"))) # the abline isn't exactly on the border
# st_write(abline,
#          "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_AB_guidance_shifted.shp",
#          append = FALSE)
# shift ab-line 45 feet north as per ELizabeth's email
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_boundary.shp" %>%
st_read()
n_plot_info <-
prep_plot(
input_name = "AMS",
unit_system = "imperial",
machine_width = 60,
section_num = 1,
harvester_width = 30,
headland_length = 60,
side_length = 15,
plot_width = 60,
min_plot_length = 60,
max_plot_length = 100
)
exp_data <-
make_exp_plots(
input_plot_info = n_plot_info,
boundary_data = boundary,
abline_data = abline,
abline_type = "lock"
)
n_rate_info <-
prep_rate(
plot_info = n_plot_info,
gc_rate = 0,
unit = "lb",
min_rate = 0,
max_rate = 80,
num_rates = 2,
design_type = "rstr"
)
td <-
assign_rates(
exp_data = exp_data,
rate_info = n_rate_info
)
viz(td, type = "rates")
write_trial_files(td,
folder_path = "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output",
ext = "shp",
zip = TRUE)
# Fornof NE starts from the SE edge of the field and the plots should start 15' into the field
# Spreader AB line at 45' in.
# Fornof SW is the same starting from the SW edge.
# The spreader width is 60' wide and the combine is 30'.
# There are 2 rates of AMS, 0 lb/ac and 80 lb/ac.
# We would like the strip plots randomized as an RCBD, so over the sets of strips.
# bring in boundary and ab-line
# Fornof NE
devtools::load_all()
abline <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_AB_guidance.shp" %>%
st_read() %>%
.[,-c(1:ncol(.))]
rotate_mat_p90 <- matrix(
c(
cos(pi / 2),
sin(pi / 2),
-sin(pi / 2),
cos(pi / 2)
),
nrow = 2
)
ab_xy <- sf::st_geometry(abline)[[1]][2, ] - sf::st_geometry(abline)[[1]][1, ]
ab_length <- sqrt(sum(ab_xy^2))
ab_xy_nml <- ab_xy / ab_length
ab_xy_nml_p90 <- ab_xy_nml %*% rotate_mat_p90
abline <- st_shift(abline, ab_xy_nml_p90*(conv_unit(-30, "ft", "m"))) # the abline isn't exactly on the border
# st_write(abline,
#          "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_AB_guidance_shifted.shp",
#          append = FALSE)
# shift ab-line 45 feet north as per ELizabeth's email
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/NE/Fornof145_NE_boundary.shp" %>%
st_read()
n_plot_info <-
prep_plot(
input_name = "AMS",
unit_system = "imperial",
machine_width = 60,
section_num = 1,
harvester_width = 30,
headland_length = 60,
side_length = 15,
plot_width = 60,
min_plot_length = 60,
max_plot_length = 100
)
exp_data <-
make_exp_plots(
input_plot_info = n_plot_info,
boundary_data = boundary,
abline_data = abline,
abline_type = "lock"
)
n_rate_info <-
prep_rate(
plot_info = n_plot_info,
gc_rate = 0,
unit = "lb",
min_rate = 0,
max_rate = 80,
num_rates = 2,
design_type = "rstr"
)
td <-
assign_rates(
exp_data = exp_data,
rate_info = n_rate_info
)
viz(td, type = "rates")
write_trial_files(td,
folder_path = "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output",
ext = "shp",
zip = TRUE)
# Fornof NE starts from the SE edge of the field and the plots should start 15' into the field
# Spreader AB line at 45' in.
# Fornof SW is the same starting from the SW edge.
# The spreader width is 60' wide and the combine is 30'.
# There are 2 rates of AMS, 0 lb/ac and 80 lb/ac.
# We would like the strip plots randomized as an RCBD, so over the sets of strips.
# bring in boundary and ab-line
# Fornof NE
devtools::load_all()
abline <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_AB_guidance.shp" %>%
st_read() %>%
.[,-c(1:ncol(.))]
rotate_mat_p90 <- matrix(
c(
cos(pi / 2),
sin(pi / 2),
-sin(pi / 2),
cos(pi / 2)
),
nrow = 2
)
ab_xy <- sf::st_geometry(abline)[[1]][2, ] - sf::st_geometry(abline)[[1]][1, ]
ab_length <- sqrt(sum(ab_xy^2))
ab_xy_nml <- ab_xy / ab_length
ab_xy_nml_p90 <- ab_xy_nml %*% rotate_mat_p90
abline <- st_shift(abline, ab_xy_nml_p90*conv_unit(-(45-2), "ft", "m")) # the abline isn't exactly on the border
st_write(abline,
"/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_AB_guidance_shifted.shp",
append = FALSE)
# shift ab-line 45 feet north as per ELizabeth's email
boundary <- "/Users/brittaniedge/Downloads/Re_ Fornof 145 boundary zips/SW/Fornof145_SW_boundary.shp" %>%
st_read()
n_plot_info <-
prep_plot(
input_name = "AMS",
unit_system = "imperial",
machine_width = 60,
section_num = 1,
harvester_width = 30,
headland_length = 60,
side_length = 15,
plot_width = 60,
min_plot_length = 60,
max_plot_length = 100
)
exp_data <-
make_exp_plots(
input_plot_info = n_plot_info,
boundary_data = boundary,
abline_data = abline,
abline_type = "lock"
)
n_rate_info <-
prep_rate(
plot_info = n_plot_info,
gc_rate = 0,
unit = "lb",
min_rate = 0,
max_rate = 80,
num_rates = 2,
design_type = "rstr"
)
td <-
assign_rates(
exp_data = exp_data,
rate_info = n_rate_info
)
viz(td, type = "rates")
write_trial_files(td,
folder_path = "/Users/brittaniedge/Library/Mobile Documents/com~apple~CloudDocs/Documents/testing output",
ext = "shp",
zip = TRUE)
